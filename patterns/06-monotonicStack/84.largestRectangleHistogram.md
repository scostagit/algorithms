Sure! Below is a **clean, line-by-line, commented JavaScript implementation** of the algorithm to solve **"84. Largest Rectangle in Histogram"**, using only **pure JavaScript**, no libraries.

I‚Äôll explain each line in comments so you can follow the logic exactly as we discussed in the layman explanation earlier.

---

```javascript
/**
 * @param {number[]} heights
 * @return {number}
 */
var largestRectangleArea = function(heights) {
    // Add a 0 at the end to flush out remaining bars in stack at the end
    heights.push(0); 

    // Stack to keep indices of the bars
    const stack = [];

    // To store the maximum area found so far
    let maxArea = 0;

    // Go through each bar in the histogram
    for (let i = 0; i < heights.length; i++) {
        // While the current bar is smaller than the bar at the top of the stack
        // (meaning we can't extend the previous bar anymore)
        while (stack.length > 0 && heights[i] < heights[stack[stack.length - 1]]) {
            // Pop the index of the last bar
            const topIndex = stack.pop();

            // Get the height of the popped bar
            const height = heights[topIndex];

            // If the stack is empty, it means the popped bar was the smallest so far,
            // so its width spans from index 0 to current index i
            const width = stack.length === 0 ? i : i - stack[stack.length - 1] - 1;

            // Calculate the area and update maxArea if it's larger
            const area = height * width;
            maxArea = Math.max(maxArea, area);
        }

        // Push current bar's index onto the stack
        stack.push(i);
    }

    // Remove the extra 0 added to the heights array (cleanup)
    heights.pop();

    // Return the maximum area found
    return maxArea;
};
```

---

## ‚úÖ Example usage with test cases

```javascript
console.log("84. Largest Rectangle in Histogram\n");

console.log("---------------------------------------------------------------------------------");
console.log("Test Case 01  --");
console.log("---------------------------------------------------------------------------------");
console.log("Input: ", [2,1,5,6,2,3]);
console.log("Output:", largestRectangleArea([2,1,5,6,2,3])); // Expected: 10
console.log("---------------------------------------------------------------------------------");

console.log("\nTest Case 02  --");
console.log("---------------------------------------------------------------------------------");
console.log("Input: ", [2,4]);
console.log("Output:", largestRectangleArea([2,4])); // Expected: 4
console.log("---------------------------------------------------------------------------------");
```

---

## üîÑ Recap of What the Code Does:

* It keeps a **stack of indices** of bars with **increasing heights**.
* When a **shorter bar** is found, it starts **calculating rectangles** using taller bars popped from the stack.
* Each time, it checks how wide the rectangle can be for that height.
* It always tracks the **largest area found**.




## Width Calculaiton

```js
const width = stack.length === 0 ? i : i - stack[stack.length - 1] - 1;
```

Let‚Äôs break this down simply:

---

## üéØ The Goal of This Line:

We're calculating **how wide** a rectangle can be using the **height** of the bar we just popped from the stack.

---

## üß± Imagine This:

You‚Äôre at index `i`, and you‚Äôve just popped a bar from the stack (let‚Äôs call its index `topIndex`).

Now, we need to know:

* **How far back can this rectangle go to the left?**
* **How far forward can it go to the right?**

The width is:

* **From the next lower-height bar to the left**
* **To the current index `i`, which is where a smaller bar just appeared**

---

## ‚úÖ The `-1` Part Explained:

Let‚Äôs explain it using an example:

### Say:

* You‚Äôre at index `i = 5`
* You popped a bar at index `topIndex = 3`
* The last element in the stack now is at index `1` (i.e., `stack[stack.length - 1] = 1`)

Now:

* That bar at index 1 is the **previous smaller bar** to the left.
* So the rectangle can span from **index 2 to 4** (that‚Äôs 3 bars wide: indices 2, 3, 4)

Thus, the width = `5 - 1 - 1 = 3`

‚Üí The `-1` is used to **exclude the index of the smaller bar on the left**, because the rectangle **starts after** it.

---

## üß† Rule of Thumb:

```js
i - stack[stack.length - 1] - 1
```

Means:

> ‚ÄúDistance between the current index `i` and the previous smaller bar‚Äôs index, excluding that smaller bar itself.‚Äù

---

## üßç‚Äç‚ôÇÔ∏è What if Stack is Empty?

```js
stack.length === 0 ? i
```

If there is **no smaller bar to the left**, that means the bar we popped can stretch **all the way from index 0 up to (i - 1)**.

So the width is `i`, which is just `i - 0`

---

## üîÅ Summary

| Stack Length | Width Formula        | Why                                 |
| ------------ | -------------------- | ----------------------------------- |
| Empty        | `i`                  | No smaller bar to the left          |
| Not Empty    | `i - stack[top] - 1` | Limited by the previous smaller bar |

